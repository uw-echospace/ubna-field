# Detection protocol


## Open up the RavenPro application

1. Log into the lab computer
2. Open up terminal on the computer
3. Copy paste the following lines to terminal, hit ENTER, and wait for RavenPro's start-up image to appear
    ```bash
    $ /opt/RavenPro1.6/RavenPro.sh
    ```
    
    
## Viewing a Sound File

1. Open up a sound file on RavenPro by going to File>"Open Sound Files..." in the main menu.
2. Browse for the sound file you want to view using the "Look In:" menu bar.
3. Select the desired sound file you want to view and hit ENTER.
4. You will be taken to a "Configure New Sound" window.
5. Selecting "Open entire sound" will open the entire audio file which may take a while in our case.
6. Selecting "Page sound" will load the audio file in segments that are "page size" long and quicker to load.
7. You may ignore all other options and hit ENTER.
8. RavenPro will generate a waveform view and a spectrogram view.
9. The bottom scroll bar will scroll through the audio while the + and - help you zoom in and out.
10. The top scroll bar (which only appears if you selected "Page sound") scrolls through the segments.
11. The <- and -> arrows change the audio to the next segment.


## Running the Single-File Detector

1. Open a sound file following the steps above. You may also use this [resource](https://ravensoundsoftware.com/wp-content/uploads/2017/11/Raven14UsersManual.pdf#page=286) for this section.
2. Open the detector function by going to Tools>Detector>"Band Limited Energy Detector" in the main menu.
3. Double-click on "Spectrogram" inside the right dialog box of "Available Signals and Views" and hit OK.
4. You are now ready to configure an energy-based detector. You can read more about configuring a Band Limited Energy Detector in the resource above. For now, we will be using preset configurations.
5. Load in a preset configuration for either LF calls or HF calls by going to Preset in the top menu of this window. Hit OK.
6. RavenPro will open a progress manager dialog box showing the detection progress.
7. Once the detector is done, you will have a selection table named "Band Limited Energy Detector".


## Understanding the Selection Table

1. Segments of audio that are selected as points of interest are known as selections by the Raven software.
2. These selections can be drawn by-hand or be generated by the RavenPro detector as detections of the desired pattern.
3. RavenPro stores every selection in two forms: Waveform and Spectrogram. This means each pair of selection entries in the selection table that have the same selection number refer to the same selection; one in Waveform view and one in Spectrogram view. Learn more about view types [here](https://ravensoundsoftware.com/wp-content/uploads/2017/11/Raven14UsersManual.pdf#page=68).
4. RavenPro also stores some default measurements for each selection such as Begin Time, End Time, Low Freq(uency), and High Freq(uency).
5. You may choose to add more measurements such as Delta Time (for duration of selection) by right-clicking on the table and going to "Choose Measurements...".


## Navigating through Selections

1. RavenPro gives users the option to quickly view through all selections from a selection table. This feature is known as a "Timed Auto Selection Advance".
2. To use this feature, we need to open a sound file and open its corresponding selection table.
3. Above the selection table and under the spectrogram, you will see a dialog box titled Delay. This area is where you can configure RavenPro to display selections individually.
4. To the left of the dialog box, there is an activated button with a down-arrow symbol. Clicking this button will trigger RavenPro to display each selection from the selection table.
5. RavenPro will display the currently activated selection, wait the number of seconds in the Delay dialog box, and jump to the next selection.
6. Click on the button to the adjacent-right of the start button to stop advancing.


## Running the Batch Detector

1. You do not need to have any audio opened for this. You may also use this [resource](https://ravensoundsoftware.com/wp-content/uploads/2017/11/Raven14UsersManual.pdf#page=275) for more detail.
2. Go to Tools>"Batch Detector..." to open the Batch Detector window.
3. Click on the "Detector:" dialog and select "Band Limited Energy Detector".
4. Click "Add" to add the sound files to run the detector on. This will open up a browsing window where you can navigate to your recordings.
5. We will be running the Batch Detector on each `recover-DATE` folder separately. To easily select all files within an opened folder, hit CTRL+A. After you have done this, hit ENTER.
6. The "Configure Detector" dialog will now be activated. Click on it and load in a preset configuration for either LF or HF calls by going to Preset in the top menu of this window. Stay on this window.
7. Go to the "Table" setting below Preset. Here we will configure what our file names will be and where RavenPro will store them after detection.
    - Click on "Browse..." to the right of "Save Directory". A file navigation window should appear.
    - Right-click inside the window and create a new folder with a name: `recover-DATE-SD_CARD#-detect`. `DATE` is the recovery date of the recordings we are using. `SD_CARD#` is the number of the SD card that originally stored the recovered recordings.
        - If this folder already exists for your selected recordings, just click on it to select it. 
    - Before you click "Select", copy everything inside "Folder Name:". You may rapid-click 3 times for a shortcut to select all of it. Use CTRL+C to copy as right-click>copy does not work here. Click on "Select" after copying.
    - The File Names will be set to `<f>.Table<tt>.txt`. Change it to `/TYPE_<f>.txt`. And paste what we copied in the last step to the left of `/TYPE`.
    - Hit "ENTER" to finalize the configuration.
8. You will be taken back to the batch detector window. Hit OK again and the progress manager will pop up to show the detection progress on all the files you have selected.
9. Once your detector is done, repeat these steps for detecting the other type of call using the other detector preset. The batch detector will remember the files you added in. All you need to change is the detector configuration using "Configure Detector".

